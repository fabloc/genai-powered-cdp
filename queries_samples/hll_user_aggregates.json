[
    {
        "question": "Number of users with age under 35, who have already bought 'Retrofit' brand products, but not after '2023-08-01'",
        "sql_query": "SELECT\nHLL_COUNT.MERGE(id_sketch) AS user_count\nFROM `cdp-demo-flocquet.publisher_1_dataset.hll_user_aggregates`\nWHERE\nage_group IN UNNEST(['-18', '19-24', '25-34'])\nAND (\nSELECT\nCOUNT(*)\nFROM\nUNNEST(total_purchased_products_by_brands) AS total_purchased_products_by_brands_unnested\nWHERE\ntotal_purchased_products_by_brands_unnested.brand_name = 'Retrofit'\n) > 0\nAND (\nSELECT\nCOUNT(*)\nFROM\nUNNEST(daily_purchased_products_by_brands) AS daily_purchased_products_by_brands_unnested\nWHERE\ndaily_purchased_products_by_brands_unnested.brand_name = 'Retrofit'\nAND DATE(session_day) > '2023-08-01'\n) = 0"
    },
    {
        "question": "Number of users who purchased for more than $50 in total and who purchased at least 2 'Roxy' products in the last 3 months",
        "sql_query": "SELECT\nHLL_COUNT.MERGE(id_sketch) AS user_count\nFROM\n`cdp-demo-flocquet.publisher_1_dataset.hll_user_aggregates`\nWHERE\ntotal_spend > 50\nAND (\nSELECT\nCOUNT(*)\nFROM\nUNNEST(daily_purchased_products_by_brands) AS daily_purchased_products_by_brands_unnested\nWHERE\ndaily_purchased_products_by_brands_unnested.brand_name = 'Roxy'\nAND DATE(session_day) >= DATE_SUB(DATE(CURRENT_DATE()), INTERVAL 3 MONTH)\n) >= 2"
    },
    {
        "question": "Number of users with age above 35, located in France, and who have already bought 'Retrofit' brand products, before August 2023",
        "sql_query": "SELECT\nHLL_COUNT.MERGE(id_sketch) AS user_count\nFROM `cdp-demo-flocquet.publisher_1_dataset.hll_user_aggregates`\nWHERE\nage_group IN UNNEST(['35-44', '45-55', '55-64', '65+'])\nAND country = 'France'\nAND (\nSELECT\nCOUNT(*)\nFROM\nUNNEST(daily_purchased_products_by_brands) AS daily_purchased_products_by_brands_unnested\nWHERE\ndaily_purchased_products_by_brands_unnested.brand_name = 'Retrofit'\nAND DATE(session_day) < '2023-08-01'\n) > 0"
    },
    {
        "question": "Number of users who spent more than $1000 in total during the last 3 months",
        "sql_query": "SELECT\nHLL_COUNT.MERGE(id_sketch) AS user_count\nFROM (\nSELECT\nid_sketch,\nSUM(daily_spend) AS spend_3m\nFROM\n`cdp-demo-flocquet.publisher_1_dataset.hll_user_aggregates`\nWHERE\nDATE(session_day) BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH) AND CURRENT_DATE()\nGROUP BY id_sketch\n)\nWHERE\nspend_3m > 1000"
    },
    {
        "question": "Number of users who spend more than $100 in 'Roxy' products in total but did not purchase any 'Roxy' product during the last 90 days",
        "sql_query": "SELECT\nHLL_COUNT.MERGE(id_sketch) AS user_count\nFROM\n`cdp-demo-flocquet.publisher_1_dataset.hll_user_aggregates`,\nUNNEST(total_purchased_products_by_brands) AS total_purchased_products_by_brands_unnested\nWHERE\ntotal_purchased_products_by_brands_unnested.brand_name = 'Roxy'\nAND total_purchased_products_by_brands_unnested.brand_spend > 100\nAND (\nSELECT\nCOUNT(*)\nFROM\nUNNEST(daily_purchased_products_by_brands) AS daily_purchased_products_by_brands_unnested\nWHERE\ndaily_purchased_products_by_brands_unnested.brand_name = 'Retrofit'\nAND DATE(session_day) BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 9 MONTH) AND CURRENT_DATE()\n) = 0"
    }    
]